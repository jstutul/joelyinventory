<!doctype html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <title>POS Dash | Welcome to pos</title>
      <link rel="shortcut icon" href="{% static 'assets/images/favicon.ico' %}" />
      <link rel="stylesheet" href="{% static 'assets/css/backend-plugin.min.css'%}">
      <link rel="stylesheet" href="{% static 'assets/css/backend.css'%}">
      <link rel="stylesheet" href="{% static 'assets/vendor/@fortawesome/fontawesome-free/css/all.min.css'%}">
      <link rel="stylesheet" href="{% static 'assets/vendor/line-awesome/dist/line-awesome/css/line-awesome.min.css'%}">
      <link rel="stylesheet" href="{% static 'assets/vendor/remixicon/fonts/remixicon.css'%}">
  </head>
  <body class="  ">
    <div class="wrapper">
      
      <div class="iq-sidebar  sidebar-default ">
          <div class="iq-sidebar-logo d-flex align-items-center justify-content-between">
              <a href="{% url 'App_inventory:dashboard'%}" class="header-logo">
                  <img src="{% static 'assets/images/logo.png' %}" class="img-fluid rounded-normal light-logo" alt="logo"><h5 class="logo-title light-logo ml-3">POSDash</h5>
              </a>
              <div class="iq-menu-bt-sidebar ml-0">
                  <i class="las la-bars wrapper-menu"></i>
              </div>
          </div>
          <div class="data-scrollbar" data-scroll="1">
              <nav class="iq-sidebar-menu">
                  <ul id="iq-sidebar-toggle" class="iq-menu">
                      <li class="active">
                          <a href="{% url 'App_inventory:dashboard'%}" class="svg-icon">                        
                              <svg  class="svg-icon" id="p-dash1" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line>
                              </svg>
                              <span class="ml-4">Dashboards</span>
                          </a>
                      </li>
                      <li class=" ">
                          <a href="#product" class="collapsed" data-toggle="collapse" aria-expanded="false">
                              <svg class="svg-icon" id="p-dash2" width="20" height="20"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle>
                                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                              </svg>
                              <span class="ml-4">Products</span>
                              <svg class="svg-icon iq-arrow-right arrow-active" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <polyline points="10 15 15 20 20 15"></polyline><path d="M4 4h7a4 4 0 0 1 4 4v12"></path>
                              </svg>
                          </a>
                          <ul id="product" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                              <li class="">
                                  <a href="{% url 'App_inventory:products'%}">
                                      <i class="las la-minus"></i><span>List Product</span>
                                  </a>
                              </li>
                              <li class="">
                                  <a href="{% url 'App_inventory:addproduct'%}">
                                      <i class="las la-minus"></i><span>Add Product</span>
                                  </a>
                              </li>
                          </ul>
                      </li>
                      {% if request.user.is_superuser == True %}                 
                      <li class=" ">
                          <a href="{% url 'App_inventory:restoreproducts'%}">
                              <svg class="svg-icon" id="p-dash4" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path>
                              </svg>
                              <span class="ml-4">Removed Product</span>                              
                          </a>                          
                      </li>   
                      {% endif %}
                      
                        <li class=" ">
                            <a href="{% url 'App_inventory:barcode'%}">
                                <svg class="svg-icon" id="p-dash4" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path>
                                </svg>
                                <span class="ml-4">BarCode</span>                              
                            </a>                          
                        </li>     
                        <li class=" ">
                            <a href="#sale">
                                <svg class="svg-icon" id="p-dash4" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path>
                                </svg>
                                <span class="ml-4">Sale</span>                              
                            </a>                          
                        </li>     
                                         
                        <li class=" ">
                            <a href="#return" class="collapsed" data-toggle="collapse" aria-expanded="false">
                                <svg class="svg-icon" id="p-dash6" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line>
                                </svg>
                                <span class="ml-4">Returns</span>
                                <svg class="svg-icon iq-arrow-right arrow-active" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="10 15 15 20 20 15"></polyline><path d="M4 4h7a4 4 0 0 1 4 4v12"></path>
                                </svg>
                            </a>
                            <ul id="return" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                                    <li class="">
                                            <a href="{% url 'App_inventory:returnproduct'%}">
                                                <i class="las la-minus"></i><span>List Returns</span>
                                            </a>
                                    </li>
                                    <li class="">
                                            <a href="{% url 'App_inventory:addreturnproduct'%}">
                                                <i class="las la-minus"></i><span>Add Return</span>
                                            </a>
                                    </li>
                            </ul>
                        </li>
                        <li class=" ">
                            <a href="#people" class="collapsed" data-toggle="collapse" aria-expanded="false">
                                <svg class="svg-icon" id="p-dash8" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                <span class="ml-4">Userlist</span>
                                <svg class="svg-icon iq-arrow-right arrow-active" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="10 15 15 20 20 15"></polyline><path d="M4 4h7a4 4 0 0 1 4 4v12"></path>
                                </svg>
                            </a>
                            <ul id="people" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                                  
                                <li class="">
                                    <a href="{% url 'App_inventory:userslist' %}">
                                        <i class="las la-minus"></i><span>Users</span>
                                    </a>
                                </li>
                                <li class="">
                                    <a href="{% url 'App_inventory:adduser' %}">
                                        <i class="las la-minus"></i><span>Add Users</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="">
                            <a href="../backend/page-report.html" class="">
                                <svg class="svg-icon" id="p-dash7" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                <span class="ml-4">Reports</span>
                            </a>
                          <ul id="reports" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                          </ul>
                        </li>
                  </ul>
              </nav>              
              <div class="p-3"></div>
          </div>
        </div>
            <div class="iq-top-navbar">
                <div class="iq-navbar-custom">
                    <nav class="navbar navbar-expand-lg navbar-light p-0">
                        <div class="iq-navbar-logo d-flex align-items-center justify-content-between">
                            <i class="ri-menu-line wrapper-menu"></i>
                            <a href="../backend/index.html" class="header-logo">
                                <img src="{% static 'assets/images/logo.png' %}" class="img-fluid rounded-normal" alt="logo">
                                <h5 class="logo-title ml-3">POSDash</h5>
            
                            </a>
                        </div>
                        <div class="iq-search-bar device-search"></div>
                        <div class="d-flex align-items-center">
                            <button class="navbar-toggler" type="button" data-toggle="collapse"
                                data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                aria-label="Toggle navigation">
                                <i class="ri-menu-3-line"></i>
                            </button>
                            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                <ul class="navbar-nav ml-auto navbar-list align-items-center">
                                    <li class="nav-item nav-icon search-content">
                                        <a href="#" class="search-toggle rounded" id="dropdownSearch" data-toggle="dropdown"
                                            aria-haspopup="true" aria-expanded="false">
                                            <i class="ri-search-line"></i>
                                        </a>
                                        <div class="iq-search-bar iq-sub-dropdown dropdown-menu" aria-labelledby="dropdownSearch">
                                            <form action="#" class="searchbox p-2">
                                                <div class="form-group mb-0 position-relative">
                                                    <input type="text" class="text search-input font-size-12"
                                                        placeholder="type here to search...">
                                                    <a href="#" class="search-link"><i class="las la-search"></i></a>
                                                </div>
                                            </form>
                                        </div>
                                    </li>
                                    
                                    <li class="nav-item nav-icon dropdown">
                                        <a href="#" class="search-toggle dropdown-toggle" id="dropdownMenuButton"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round" class="feather feather-bell">
                                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                            </svg>
                                            <span class="bg-primary "></span>
                                        </a>
                                        <div class="iq-sub-dropdown dropdown-menu" aria-labelledby="dropdownMenuButton">
                                            <div class="card shadow-none m-0">
                                                <div class="card-body p-0 ">
                                                    <div class="cust-title p-3">
                                                        <div class="d-flex align-items-center justify-content-between">
                                                            <h5 class="mb-0">Notifications</h5>
                                                            <a class="badge badge-primary badge-card" href="#">{{notifications.count}}</a>
                                                        </div>
                                                    </div>
                                                    <div class="px-3 pt-0 pb-0 sub-card">
                                                        {% for notification in notifications %}
                                                            <a href="#" class="iq-sub-card">
                                                                <div class="media align-items-center cust-card py-3 border-bottom">
                                                                    <div class="">
                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bell">
                                                                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                                                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                                                        </svg>
                                                                    </div>
                                                                    <div class="media-body ml-3">
                                                                        <div class="d-flex align-items-center justify-content-between">
                                                                            <h6 class="mb-0">{{notification.user}}</h6>
                                                                            <small class="text-dark"><b>{{notification.created}}</b></small>
                                                                        </div>
                                                                        <small class="mb-0">{{notification.message}}</small>
                                                                    </div>
                                                                </div>
                                                            </a>
                                                        {% endfor %}
                                                    </div>
                                                    {% if notifications.count > 0 %}
                                                    <a class="right-ic btn btn-primary btn-block position-relative p-2" href="#"
                                                        role="button">
                                                        View All
                                                    </a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="nav-item nav-icon dropdown caption-content">
                                        <a href="#" class="search-toggle dropdown-toggle" id="dropdownMenuButton4"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <img src="{% static 'assets/images/user/1.png'%}" class="img-fluid rounded" alt="user">
                                        </a>
                                        <div class="iq-sub-dropdown dropdown-menu" aria-labelledby="dropdownMenuButton">
                                            <div class="card shadow-none m-0">
                                                <div class="card-body p-0 text-center">
                                                    <div class="media-body profile-detail text-center">
                                                        <img src="{% static 'assets/images/page-img/profile-bg.jpg'%}" alt="profile-bg"
                                                            class="rounded-top img-fluid mb-4">
                                                        <img src="{% static 'assets/images/user/1.png'%}" alt="profile-img"
                                                            class="rounded profile-img img-fluid avatar-70">
                                                    </div>
                                                    <div class="p-3">
                                                        <h5 class="mb-1">
                                                        {% if request.user.get_full_name %}
                                                            {{ request.user.get_full_name }}
                                                        {% else %}
                                                            {{ request.user.username }}
                                                        {% endif %}   
                                                        </h5>
                                                        <p class="mb-0">{{user.last_login}}</p>
                                                        <div class="d-flex align-items-center justify-content-center mt-3">
                                                            <a href="../app/user-profile.html" class="btn border mr-2">Profile</a>
                                                            <a href="{% url 'App_Auth:logout'%}" class="btn border">Sign Out</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        <div class="content-page">
            {% block main %}

            {% endblock %}
        </div>
    </div>
    <script src="{% static 'assets/js/backend-bundle.min.js'%}"></script>
    <script src="{% static 'assets/js/table-treeview.js'%}"></script>
    <script src="{% static 'assets/js/customizer.js'%}"></script>
    <script async src="{% static 'assets/js/chart-custom.js'%}"></script>
    <script src="{% static 'assets/js/app.js'%}"></script>
    <script>
        $(document).ready(function() {
            function ShowError(status,field,msg){
                if (status===1) {
                    field.addClass('is-invalid');
                    field.siblings('.help-block').text(msg);
                    field.siblings('.invalid-feedback').text(msg);
                } else {
                    field.removeClass('is-invalid');
                    field.siblings('.help-block').text('');
                    field.siblings('.invalid-feedback').text('');
                }
            }

            $(document).on('submit', '#adduserform', function(e) {
                e.preventDefault();
                var isValid = 0;
                var First_Name     = $("#firstname");
                var Last_Name      = $("#lastname");
                var Email_Address  = $("#email");
                var User_Name      = $("#username");
                var Password_1     = $("#password1");
                var Password_2     = $("#password2");

                if (First_Name.val() === '' || First_Name.val() === null) {
                    ShowError(1,First_Name,"Please provide a frstname.");
                    isValid+=1;
                }else{
                    var regex = /^[A-Za-z]+$/;
                    if(!regex.test(First_Name.val())){
                        isValid +=0;
                        ShowError(1,First_Name,"Only allow alphabet character.")
                    }else{
                        ShowError(0,First_Name,"")
                    }
                }

                if (Last_Name.val() === '' || Last_Name.val() === null) {
                    ShowError(1,Last_Name,"Please provide a lastname.");
                    isValid+=1;
                }else{
                    var regex = /^[A-Za-z]+$/;
                    if(!regex.test(Last_Name.val())){
                        isValid +=0;
                        ShowError(1,Last_Name,"Only allow alphabet character.");
                        
                    }else{
                        ShowError(0,Last_Name,"");
                    }
                }

                if (Email_Address.val() === '' || Email_Address.val() === null) {
                    ShowError(1,Email_Address,"Please provide a email.");
                    isValid+=1;
                }else{
                    var regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if(!regex.test(Email_Address.val())){
                        isValid +=0;
                        ShowError(1,Email_Address,"Email is not valid.")
                    }else{
                        ShowError(0,Email_Address,"")
                    }
                }

                if (User_Name.val() === '' || User_Name.val() === null) {
                    ShowError(1,User_Name,"Please provide a username.");
                    isValid+=1;
                }else{
                    ShowError(0,User_Name,"")
                }
                console.log(Password_1.val(),Password_2.val())
                if (Password_1.val() === '' || Password_1.val() === null) {
                    ShowError(1,Password_1,"Please provide a password.");
                    isValid+=1;
                }else{
                    if(Password_1.val().length <8){
                        isValid+=1;
                        ShowError(1,Password_1,"Please provide 8 digit password");
                    }else{
                        ShowError(0,Password_1,"")
                    }
                }
                if(Password_2.val() ==='' || Password_2.val() != Password_1.val()){
                    ShowError(1,Password_2,"Please provide same password");
                    isValid+=1;
                }else{
                    ShowError(0,Password_2,"")
                }
                if(isValid==0){
                    this.submit();
                }
            })
        });
        $('#adduserform').on('reset', function () {
            $(this).find('.is-invalid').removeClass('is-invalid');
            $(this).find('.invalid-feedback').hide();
        });
        $(document).on('click',".userdelete",function(){
            var uid=$(this).attr('userid');
            $("#userdeletemodal").val(uid);
        })
        $(document).on('click',".userproduct",function(){
            var uid=$(this).attr('pid');
            $("#productdeletemodal").val(uid);
        })
        $(document).on('click',".backrestoreproduct",function(){
            var uid=$(this).attr('pid');
            $("#backrestoreproductmodal").val(uid);
        })
        $(document).on('click',".deleterestoreproduct",function(){
            var uid=$(this).attr('pid');
            $("#deleterestoreproductmodal").val(uid);
        })

        $(document).on('change','#id_product',function(){

            var productId = $(this).val();

            $.ajax({
            url: '{% url 'App_inventory:pquantity'%}',
            data: { id: productId },
            dataType: 'json',
            success: function(response) {
                console.log(response);
                $("#id_quantity").val(response.quantity);
            },
            error: function(xhr, status, error) {
                alert('Error:', error);
            }
            });
        })
        $(document).on('change','#barcode_product_id',function(){

            var productId = $(this).val();
            if (productId=="-1"){
                alert("Select product first");
                return false;
            }
            $.ajax({
            url: 'barcode/image',
            data: { id: productId },
            dataType: 'json',
            success: function(response) {
                $("#barcodeimg").attr("src",response.barcode);
            },
            error: function(xhr, status, error) {
                alert('Error:', error);
            }
            });

            $(document).on('click','#downloadButton',function() {
                // Get the image source
                var imageSrc = $('#barcodeimg').attr('src');
        
                // Create a hidden canvas element
                var canvas = document.createElement('canvas');
                var ctx = canvas.getContext('2d');
                
                // Set the canvas size to 2x3 inches (at 300 DPI)
                canvas.width = 600;  // 2 inches * 300 DPI
                canvas.height = 900; // 3 inches * 300 DPI
                
                // Number of images to generate and download
                var count = 10;
                
                // Create a container for the download links
                var downloadContainer = document.createElement('div');
        
                // Loop to generate and download multiple images
                for (var i = 1; i <= count; i++) {
                    // Create an image element
                    var image = new Image();
                    image.src = imageSrc;
        
                    // When the image is loaded, draw it on the canvas and create a download link
                    image.onload = function() {
                        ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
        
                        // Convert the canvas to a data URL
                        var dataURL = canvas.toDataURL('image/png');
        
                        // Create a download link
                        var downloadLink = document.createElement('a');
                        downloadLink.href = dataURL;
                        downloadLink.download = 'barcode_' + i + '.png';
        
                        // Append the download link to the container
                        downloadContainer.appendChild(downloadLink);
        
                        // If all images are loaded, trigger the download for all links
                        if (i === count) {
                            document.body.appendChild(downloadContainer);
                            $(downloadContainer).children('a').each(function() {
                                $(this).get(0).click();
                            });
                            document.body.removeChild(downloadContainer);
                        }
                    };
                }
            });
            $('#downloadButton').click(function() {
                // Print the specific image
                var barcodeImg = document.getElementById('barcodeimg');
                var printWindow = window.open('', '_blank');
                printWindow.document.write('<html><head><title>Print</title></head><body>');
                printWindow.document.write('<img src="' + barcodeImg.src + '">');
                printWindow.document.write('</body></html>');
                printWindow.document.close();
                printWindow.print();
                printWindow.close();
            });
        })
        </script>
        
  </body>
</html>